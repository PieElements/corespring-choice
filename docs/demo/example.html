
<!doctype html>
<html>
  <head>
    <!-- lodash is one of the supported libs on the controller side -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/lodash.js/4.16.2/lodash.js" type="text/javascript"></script>
    <script src="pie.js" type="text/javascript"></script>
    <script src="controllers.js" type="text/javascript"></script>
    <script type="text/javascript">
    
      document.addEventListener('DOMContentLoaded', function(){

        env = {mode: 'gather'};
        model = {'pies':[{'id':'1','pie':{'name':'corespring-multiple-choice-react','version':'1.0.0'},'correctResponse':['apple','carrot'],'feedback':{'apple':'$FB_APPLE','banana':'What are you thinking?','carrot':'good for your eyes','donut':'Try not licking your lips'},'translations':{'default_locale':'en_US','en_US':{'PROMPT':'Choose the 2 tastiest things','LABEL_APPLE':'Apple','LABEL_BANANA':'Banaa','LABEL_CARROT':'Carrot','LABEL_DONUT':'Donut','FB_APPLE':'Apples are so tasty'},'es_ES':{'PROMPT':'Elija las 2 cosas m\xE1s sabrosas','LABEL_APPLE':'manzana','LABEL_BANANA':'pl\xE1tano','LABEL_CARROT':'zanahoria','LABEL_DONUT':'bu\xF1uelo','FB_APPLE':'Las manzanas son tan sabroso'}},'model':{'prompt':'Choose the 2 tastiest things','choiceMode':'checkbox','keyMode':'numbers','disabled':false,'choices':[{'label':'Apple','value':'apple'},{'label':'Banana','value':'banana'},{'label':'Carrot','value':'carrot'},{'label':'Donut','value':'donut'}]}}]};
        session = [];
        
        var player = document.querySelector('pie-player');

        player.addEventListener('pie-player-ready', function(event){
          var pieController = new pie.Controller(model, pie.controllerMap);
          player.controller = pieController;
          player.env = env;
          player.session = session;
          
          var panel = document.querySelector('pie-control-panel');
          panel.env = { mode: 'gather' };
          panel.addEventListener('envChanged', function(event){
            console.log('envChanged', event.target.env);
            player.env = event.target.env;    
            
            if(event.target.env.mode === 'evaluate'){
              player.getOutcome().then(function(outcome){
                console.log('outcome', outcome);
                panel.score = " &nbsp; " + outcome.summary.percentage + "% (" + outcome.summary.points + "/" + outcome.summary.maxPoints + ") &nbsp; "; 
              });
            }
          });
        });
      });
    </script>
  </head>
  <body>
    <pie-control-panel></pie-control-panel>
    <pie-player>
    <corespring-multiple-choice-react data-id="1"></corespring-multiple-choice-react>
    </pie-player>
  </body>
</html>
